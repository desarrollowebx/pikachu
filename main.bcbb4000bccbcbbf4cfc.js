"use strict";(self.webpackChunkpikachu_volleyball_p2p_online=self.webpackChunkpikachu_volleyball_p2p_online||[]).push([[179],{5718:(e,t,i)=>{var r=i(5812),s=(i(451),i(3227)),n=i(1622),a=i(1645),o=i(1203),h=i(5253),y=i(1605),l=i(3093),d=i(390);class u extends s.c{constructor(e,t){super(e,t),this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.keyboardArray[0].unsubscribe(),this.keyboardArray[1].unsubscribe(),this.myKeyboard=n.zw,this.myOnlineKeyboard=new n.cx(this.myKeyboard.inputQueue),this.peerOnlineKeyboard=new n.cx(a.CE.peerInputQueue),this._amIPlayer2=!1,this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard],this._syncCounter=0,this.noInputFrameTotal.menu=1/0,this.isFirstGame=!0,this.willSaveReplay=!0}get amIPlayer2(){return this._amIPlayer2}set amIPlayer2(e){this._amIPlayer2=e,a.CE.amIPlayer2=e,!0===this._amIPlayer2?this.keyboardArray=[this.peerOnlineKeyboard,this.myOnlineKeyboard]:this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard]}get syncCounter(){return this._syncCounter}set syncCounter(e){this._syncCounter=(0,o.w)(e,a.ay)}intro(){0===this.frameCounter&&(this.selectedWithWho=0,this.isFirstGame?(this.isFirstGame=!1,this.amIPlayer2=!a.CE.amICreatedRoom):a.CE.isQuickMatch&&(0,h.Ei)()),super.intro()}menu(){const e=this.selectedWithWho;super.menu(),this.selectedWithWho!==e&&(this.amIPlayer2=!this.amIPlayer2,(0,y.S)(a.CE.myNickname,this.amIPlayer2),(0,y.S)(a.CE.peerNickname,!this.amIPlayer2),(0,y.e)(a.CE.myPartialPublicIP,this.amIPlayer2),(0,y.e)(a.CE.peerPartialPublicIP,!this.amIPlayer2))}gameLoop(){a.CE.gameStartAllowed&&a.CE.isOpen&&(this.myKeyboard.getInputIfNeededAndSendToPeer(this.syncCounter),this.gameLoopFromGettingPeerInput())}gameLoopFromGettingPeerInput(){if(this.peerOnlineKeyboard.isInputOnQueue(this.syncCounter)){if(this.myOnlineKeyboard.isInputOnQueue(this.syncCounter)){if(this.peerOnlineKeyboard.getInput(this.syncCounter),this.myOnlineKeyboard.getInput(this.syncCounter),this.syncCounter++,this.willSaveReplay){const e=new d.P3;e.xDirection=this.keyboardArray[0].xDirection,e.yDirection=this.keyboardArray[0].yDirection,e.powerHit=this.keyboardArray[0].powerHit;const t=new d.P3;t.xDirection=this.keyboardArray[1].xDirection,t.yDirection=this.keyboardArray[1].yDirection,t.powerHit=this.keyboardArray[1].powerHit,l.Q.recordInputs(e,t)}if(this.slowMotionFramesLeft>0){if(this.slowMotionNumOfSkippedFrames++,this.slowMotionNumOfSkippedFrames%Math.round(this.normalFPS/this.slowMotionFPS)!=0)return;this.slowMotionFramesLeft--,this.slowMotionNumOfSkippedFrames=0}this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.state(),this.peerOnlineKeyboard.inputQueue.length>n.ID&&(this.myOnlineKeyboard.inputQueue.length>n.ID?window.setTimeout(this.gameLoopFromGettingPeerInput.bind(this),0):window.setTimeout(this.gameLoop.bind(this),0))}}else a.CE.callbackAfterPeerInputQueueReceived=this.gameLoopFromGettingPeerInput.bind(this)}}var p=i(5093),c=i(6511),m=i(7495);const b=p.d.TEXTURES;b.WITH_COMPUTER=b.WITH_FRIEND;const I=r.Xd;I.RESOLUTION=window.devicePixelRatio,I.SCALE_MODE=r.aH.NEAREST,I.ROUND_PIXELS=!0;const C=r.e6({width:432,height:304,antialias:!1,backgroundColor:0,transparent:!1}),P=new r.W2,w=new r.vB,O=new r.aN;document.querySelector("#game-canvas-container").appendChild(C.view),C.render(P),O.add(p.d.SPRITE_SHEET);for(const e in p.d.SOUNDS)O.add(p.d.SOUNDS[e]);function g(){const e=new u(P,O.resources);(0,h.IW)(e,w),(0,m.IJ)(e),function(e){w.maxFPS=e.normalFPS,w.add((()=>{C.render(P),e.gameLoop()})),w.start()}(e)}!function(){const e=document.getElementById("loading-box"),t=document.getElementById("progress-bar");O.onProgress.add((()=>{t.style.width=`${O.progress}%`})),O.onComplete.add((()=>{e.classList.contains("hidden")||e.classList.add("hidden")}))}(),a.CE.callbackAfterDataChannelOpened=()=>{O.load(g)},(0,h.yA)(),(0,c.g)()}},e=>{e.O(0,[931,692],(()=>(5718,e(e.s=5718)))),e.O()}]);
//# sourceMappingURL=main.bcbb4000bccbcbbf4cfc.js.map